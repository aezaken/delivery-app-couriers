# Воспроизведение бага в yandex_maps_mapkit

Этот проект демонстрирует проблему: `SearchSuggestSession.suggest()` не возвращает ответ и не вызывает `onError`.

## Архитектура проекта

Проект представляет собой монорепозиторий с двумя основными приложениями:

1. **`courier_app`** - приложение для курьеров.
2. **`dispatcher_app`** - приложение для диспетчеров.
3. **`shared_data`** - общий пакет с моделями данных и сервисами API.
4. **`shared_ui`** - общий пакет с общими виджетами, цветами и стилями.

Такая структура позволяет избежать дублирования кода и упрощает сопровождение.

## Интеграция с Yandex Maps Mapkit

В `dispatcher_app` используется библиотека `yandex_maps_mapkit` для отображения карт и поиска адресов. Проблема проявляется при попытке использовать `SearchSuggestSession` для автодополнения адресов.

### Ключевая проблема

Метод `suggest()` не вызывает ни функцию обратного вызова `onResponse`, ни `onError`, даже при наличии корректного API-ключа и правильной инициализации.

```dart
// Пример кода, где проявляется баг
final session = SearchSuggestSession();
await session.suggest(
  text: query,
  onResponse: (items) {
    // Этот код НЕ ВЫПОЛНЯЕТСЯ
    setState(() {
      suggestions = items;
    });
  },
  onError: (error) {
    // Этот код ТОЖЕ НЕ ВЫПОЛНЯЕТСЯ
    print('Error: $error');
  },
);
```

### Обходное решение

В качестве временного решения используется прямой HTTP-запрос к публичному API Яндекса:

```dart
final response = await http.get(
  Uri.parse(
    'https://suggest-maps.yandex.net/suggest-geo?text=$query&origin=jsapi-2.1'
  ),
);
```

## Как запустить проект

1. Скопируйте `.env.example` в `.env`:
   ```bash
   cp dispatcher_app/.env.example dispatcher_app/.env
   ```

2. Вставьте свой API-ключ Яндекс Карт в файл `dispatcher_app/.env`:
   ```env
   YANDEX_MAPKIT_API_KEY=ваш_ключ_здесь
   ```

3. Установите зависимости:
   ```bash
   flutter pub get
   ```

4. Запустите приложение:
   ```bash
   flutter run -d <device_id> --target lib/main.dart
   ```

## Где проявляется проблема

Проблема проявляется на экране создания заказа в `dispatcher_app` - при вводе текста в поле адреса. Виджет поиска не показывает подсказки.

## Безопасность и настройки

- API-ключ удален из кода и хранится в `.env` файле.
- Файл `.env` добавлен в `.gitignore`, чтобы предотвратить его попадание в репозиторий.
- Используется `flutter_dotenv` для загрузки переменных окружения.
- Проект подготовлен к публикации: ключи скрыты, .gitignore обновлён.

## Стек технологий

- **Фронтенд:** Flutter
- **Backend:** Node.js / Express
- **База данных:** PostgreSQL
- **Веб-сервер:** Nginx
- **Push-уведомления:** Firebase Cloud Messaging
- **Веб-сокеты:** Для реального времени между диспетчером и курьерами

## Соглашения

- **Стиль кода:** `camelCase` на фронтенде, `snake_case` в базе данных
- **Конфигурация:** Используется библиотека `dotenv`
- **Архитектура:** Provider для управления состоянием, раздельные пакеты для общего кода

## Связанные задачи

Этот баг связан с идеей из `project_progress.md` о реализации автодополнения адреса при создании заказа. Первоначально планировалось использовать встроенный механизм `yandex_maps_mapkit`, но из-за этого бага пришлось реализовать обходное решение через прямые HTTP-запросы.